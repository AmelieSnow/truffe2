{% extends "base.html" %}
{% load i18n %}
{% load rights_extras %}

{% block title %}{{block.super}} :: {{Model.MetaData.base_title}} :: {% trans "Liste" %}{% endblock %}

{% block ribbon %}
    {{block.super}}
    <li><i class="{{Model.MetaData.base_icon}}"></i> {{Model.MetaData.base_title}}</li>
  {% endblock %}

{% block content %}
    <h1>{% block content_title %}{{Model.MetaData.list_title}}{% endblock %}</h1>

    {% if moderables %}

      <div class="alert alert-warning">
        <i class="glyphicon glyphicon-warning-sign"></i>
          {% trans "Il y a des éléments à modérer !" %}
          <div class="btn-group">
              <button class="btn btn-xs btn-info dropdown-toggle" data-toggle="dropdown">{% trans "Accès rapide" %} <span class="caret"></span></button>
              <ul class="dropdown-menu">
                  {% for moderable in moderables %}
                      <li><a href="{% url show_view moderable.pk %}">{{moderable}}</a></li>
                  {% endfor %}
              </ul>
          </div>
      </div>

    {% endif %}

    <section id="widget-grid" class="">
        <div class="row">
          <div class="col-sm-12 col-md-{% if unit_mode or Model.MetaData.help_list %}10{% else %}12{% endif %} col-lg-{% if unit_mode or Model.MetaData.help_list %}10{% else %}12{% endif %}">
                {% with w_title="Liste" w_nopadding=True %}{% include "widget/header.html" %}{% endwith %}
                    <div class="widget-body-toolbar"></div>
                    <table id="main_list_table" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                {% block main_list_header %}{% endblock %}
                                {% for col, display in Model.MetaData.list_display %}
                                    <th>{{display}}</th>
                                {% endfor %}
                                <th style="width: 200px;"></th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>

                    <hr style="clear: both; visibility: hidden;">

                {% include "widget/footer.html" %}
            </div>

            {% if unit_mode or Model.MetaData.help_list %}
                <div class="col-sm-12 col-md-2 col-lg-2">
                    {% if unit_mode %}
                      {% with function_to_call="unit_updated" %}
                          {% include "units/selector/unit_selector.html" %}
                      {% endwith %}
                    {% endif %}

                    {% if Model.MetaData.help_list %}
                        {% with w_title="Aide" %}{% include "widget/header.html" %}{% endwith %}
                            {% block help %}{{Model.MetaData.help_list|linebreaksbr}}{% endblock %}
                        {% include "widget/footer.html" %}
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </section>


    {% if unit_mode %}
      <script type="text/javascript">

        function refresh_list() {
          data_table_main_list_table._fnAjaxUpdate();
        }

        function unit_updated(pk, name, can_edit) {
          refresh_list();
        }

      </script>
    {% endif %}

    {% with id="main_list_table" json_url=json_view status_filter=Model.MetaState.states_default_filter states=Model.MetaState.states status_col_id=Model.MetaState.status_col_id with_upk=unit_mode %}{% include "datatables.html" %}{% endwith %}

    {% block buttons %}
        <div style="float: right;">

            {% ifhasright Model user '!RESTORE' %}
              <a href="{% url deleted_view %}" class="btn btn-info">
                <i class="fa fa-list"></i>
                {% trans "Élements supprimés" %}
              </a>
            {% endifhasright %}
            {% ifhasright Model user '!CREATE' %}
              <a href="{% url edit_view '~' %}" class="btn btn-primary">
                <i class="fa fa-plus"></i>
                {% trans "Ajouter" %}
              </a>
            {% endifhasright %}
        </div>
    {% endblock %}


    <br /><br />
{% endblock %}


{% block menuid %}{{Model.MetaData.menu_id}}{% endblock %}
