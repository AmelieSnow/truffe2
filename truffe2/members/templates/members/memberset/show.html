{% extends "generic/generic/show.html" %}
{% load i18n generic_extras rights_extras %}

{% block content %}
    <div role="widget" class="jarviswidget jarviswidget-sortable" id="wid-id-11" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false">
        <header role="heading">
            <h2>{{obj}}</h2>

            <ul id="widget-tab-memberset" class="nav pull-right nav-tabs">
                <li class="">
                    <a data-toggle="tab" href="#hr1"> <i class="fa fa-lg fa-list"></i> <span class="hidden-mobile hidden-tablet">{% trans "Liste" %}</span> </a>
                </li>
                <li class="active">
                    <a data-toggle="tab" href="#hr2"> <i class="fa fa-lg fa-gear"></i> <span class="hidden-mobile hidden-tablet">{% trans "Gestion" %}</span></a>
                </li>
            </ul>

            <span class="jarviswidget-loader"><i class="fa fa-refresh fa-spin"></i></span>
        </header>

        <!-- widget div-->
        <div role="content">

            <!-- widget edit box -->
            <div class="jarviswidget-editbox">
                <!-- This area used as dropdown edit box -->
            </div> <!-- end widget edit box -->

            <div class="widget-body no-padding"> <!-- widget content -->

                <div class="tab-content padding-10"> <!-- widget body text-->
                    <div class="tab-pane fade" id="hr1">
                        <section id="widget-grid" class="">
                            <div class="row">
                                <div class="col-sm-12 col-md-{% if Model.MetaData.help_list %}10{% else %}12{% endif %} col-lg-{% if Model.MetaData.help_list %}10{% else %}12{% endif %}">
                                    {% with w_title="Liste" w_nopadding=True %}{% include "widget/header.html" %}{% endwith %}
                                    <div class="widget-body-toolbar"></div>
                                    <table id="main_list_table" class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th><input type="checkbox" class="dt_main_checkbox"></th>
                                                <th style="width: 200px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>

                                    <div style="padding: 5px; display: none;" id="doable_block">
                                        <div class="pull-right" style="margin-right: 5px;">
                                          {% trans "Effectuer une action sur les <span id='doable_nb'></span> élément(s) sélectionné(s) :" %}

                                          <div id="doable_buttons" style="text-align: right;"></div>

                                        </div>

                                    </div>

                                    <hr style="clear: both; visibility: hidden;">

                                    {% include "widget/footer.html" %}

                                    <div style="float: right;">
                                        {% ifhasright Model user '!SHOW' %}
                                          <a href="{% url 'members.views.export_members' obj.pk %}" class="btn btn-default">
                                            <i class="fa fa-download"></i>
                                            {% trans "Exporter" %}
                                          </a>
                                        {% endifhasright %}

                                        {% ifhasright Model user '!CREATE' %}
                                          <a href="{% url 'members.views.import_members' obj.pk %}" class="btn btn-default">
                                            <i class="fa fa-upload"></i>
                                            {% trans "Importer" %}
                                          </a>
                                        {% endifhasright %}

                                        {% ifhasright Model user '!CREATE' %}
                                          <a href="#" onclick="disp_add();" data-remote="{% url 'members.views.membership_add' obj.pk %}" base-data-remote="{% url 'members.views.membership_add' obj.pk %}" id="add-accred-button" class="btn btn-primary">
                                            <i class="fa fa-plus"></i>
                                            {% trans "Ajouter" %}
                                          </a>
                                        {% endifhasright %}
                                    </div>
                                </div>

                                {% if Model.MetaData.help_list %}
                                    <div class="col-sm-12 col-md-2 col-lg-2">
                                        {% if Model.MetaData.help_list %}
                                            {% with w_title="Aide" %}{% include "widget/header.html" %}{% endwith %}
                                                {{Model.MetaData.help_list|linebreaksbr}}
                                            {% include "widget/footer.html" %}
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </div>
                        </section>
                        {% url 'members.views.membership_list_json' obj.pk as json_url_memberset %}
                        {% with id="main_list_table" json_url_manual=json_url_memberset %}{% include "datatables.html" %}{% endwith %}
                    </div>
                    <div class="tab-pane fade active in" id="hr2">
                        {{block.super}}
                        <div style="padding-bottom: 40px;"></div> <!-- padding for buttons -->
                    </div>
                </div> <!-- end widget body text-->
            </div> <!-- end widget content -->
        </div> <!-- end widget div -->
    </div>

    <br /><br />

    <div class="modal fade" id="modal-add-accred" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            </div>
        </div>
    </div>
{% endblock %}

{% block bonus_box %}
    <script type="text/javascript">

        $(function() {
            // Remove title in super SHOW from generic
            $('#hr2 h1').remove();
            $('#hr2 hr').remove();

            // Activate list panel after load, in order to display status correctly on management panel.
            $('#widget-tab-memberset li:first a').click();

            // Call the list content for List panel
            $.ajax("{% url 'members.views.membership_load_list' obj.pk %}", {'dataType': 'json'}).success(function (data) {
                var headers = '';
                for(var head_elem of data.header) {
                    headers += '<th>' + head_elem + '</th>';
                }
                $('thead th:first').after(headers);

                /*for(var body_elem of data.body) {
                    var body_row = '<tr class="member-pk-' + body_elem[0] + '">';
                    for(var idx = 1; idx < body_elem.length; idx++) {
                        body_row += '<td>' + body_elem[idx] + '</td>';
                    }
                    $('tbody').append(body_row + '</tr>');
                }*/
            });
        });

        function disp_add() {
            //Allow usage of select2
            $.fn.modal.Constructor.prototype.enforceFocus = function () {};
            $('#modal-add-accred').find('.modal-content').html('');
            $('#modal-add-accred').removeData('bs.modal');
            $('#modal-add-accred').modal({remote: $('#add-accred-button').attr('data-remote')});
        }
    </script>
{% endblock %}